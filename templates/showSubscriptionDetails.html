<!-- templates/showSubscriptionDetails.html -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Subscription Details</title>
</head>
<body>
    <h1>Subscription Details</h1>
    <div id="subscription-details">
        {{range $key, $value := .}}
            <p><strong>{{$key}}:</strong> {{$value}}</p>
        {{end}}
    </div>
    <button id="activateButton">Activate Subscription</button>

    <script>
        document.getElementById('activateButton').onclick = function() {
            fetch('/activateSubscription', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: 'yourTokenHere' }) // Adjust payload as needed
            })
            .then(response => {
                if (response.ok) alert("Subscription activated!");
                else alert("Activation failed");
            })
            .catch(error => console.error('Error:', error));
        };
    </script>
</body>
</html>
 -->

 <!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Subscription Details</title>
   <style>
     * {
       box-sizing: border-box;
       margin: 0;
       padding: 0;
       font-family: Arial, sans-serif;
     }
 
     body {
       background-color: #f5f5f5;
       color: #333;
       padding: 20px;
     }
 
     .container {
       display: flex;
       gap: 20px;
       width: 100%;
       margin-top: 45px;
     }
 
     .status-box {
       width: 240px; /* Increased size */
       height: 240px; /* Increased size */
       background-color: #66cc33;
       display: flex;
       align-items: center;
       justify-content: center;
       color: white;
       border-radius: 8px;
       text-align: center;
       margin-top: 30px;
     }
 
     .status-text h1 {
       font-size: 72px; /* Increased font size */
       margin: 0;
     }
 
     .status-text p {
       font-size: 18px; /* Increased font size */
       margin: 0;
     }
 
     .content {
       flex: 1;
       background-color: #fff;
       border-radius: 8px;
       padding: 20px;
       box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
       margin-top: 30px;
     }
 
     header {
       display: flex;
       justify-content: space-between;
       align-items: center;
       margin-bottom: 20px;
     }
 
     header h2 {
       font-size: 24px;
     }
 
     .buttons .btn {
       background-color: #0066cc;
       color: #fff;
       border: none;
       padding: 8px 12px;
       margin: 0 5px;
       cursor: pointer;
       border-radius: 4px;
       font-size: 14px;
     }
 
     .buttons .btn:hover {
       opacity: 0.9;
     }
 
     .tabs {
       display: flex;
       gap: 10px;
       margin-bottom: 20px;
     }
 
     .tab-btn {
       background-color: #f0f0f0;
       border: none;
       padding: 8px 12px;
       cursor: pointer;
       font-size: 14px;
       border-radius: 4px;
     }
 
     .tab-btn.active {
       background-color: #0066cc;
       color: white;
     }
 
     .tab-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
 
     .tab-content.active {
       display: block;
     }
 



        .tab-content ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
 
     .tab-content li {
       margin-bottom: 8px;
     }
 
     .tab-content a {
       color: #0066cc;
       text-decoration: none;
       font-size: 14px;
       margin-left: 8px;
     }

      /* Responsive styling */
      @media (max-width: 768px) {
            .tab-content {
                flex-direction: column;
            }
        }
 
     .data-guard-section {
       margin-top: 20px;
       padding: 15px;
       border-top: 1px solid #ddd;
     }
 
     .data-guard-section h3 {
       font-size: 18px;
       margin-bottom: 10px;
     }
 
     .data-guard-section p {
       font-size: 14px;
       color: #666;
       margin-top: 10px;
     }
 
     .btn.enable {
       background-color: #0066cc;
       color: #fff;
       border: none;
       padding: 8px 12px;
       cursor: pointer;
       border-radius: 4px;
       font-size: 14px;
     }

    .top-bar {
       width: 100%;
       background-color: rgb(11, 69, 177);
       color: white;
       text-align: center;
       padding: 10px 0;
       position: fixed;
       top: 0;
       left: 0;
       z-index: 1000; /* Ensure it stays on top */
       display: flex;
       align-items: center;
       justify-content: space-between;
       padding: 10px 20px;
       margin-bottom: 20px;
    }

    /* Logo styling */
    .logo {
        height: 40px; /* Adjust the height to fit the logo */
        width: auto;
        margin-right: 10px;
    }

    /* Left section containing logo and site name */
    .left-side {
        display: flex;
        align-items: center;
    }

    .partner-site-name {
       font-size: 18px;
       font-weight: bold;
    } 
     #content {
        display:none;
     }
     #container {
        display:none;
     }
     .info-column {
            flex: 1;
            padding: 10px;
            min-width: 250px
        }
    .main-heading {
        padding-bottom: 50px;
    }
    .sub-heading {
        padding-bottom: 25px;
    }
   </style>
 </head>
 <body>
    <div class="top-bar">
        <div class="left-side">
            <!-- <img src="../images/logo.png" alt="Partner Logo" class="logo"> -->
            <span class="partner-site-name"></span>
        </div>
    </div>


   <div class="container">
     <div class="status-box">
       <div class="status-text">
         <h1 id="subscriptionStatus">S</h1>
         <p id="lifecycleDetails">PENDING ACTIVATION</p>
       </div>
     </div>
 
     <div class="content">
       <header>
         <h2 id="subscriptionName"></h2>
         <div class="buttons">
           <button class="btn" id="activateButton" onclick="activateSubscription()">Activate</button>
           <!-- <button class="btn">Restore</button>
           <button class="btn">Apply Tag(s)</button> -->
         </div>
       </header>

       <h1 class="main-heading">Subscription Details</h1>
 
       <!-- <div class="tabs">
         <button class="tab-btn active" onclick="openTab('information')">Subscription Details</button>
         <button class="tab-btn" onclick="openTab('tags')">Other Details</button>
       </div> -->
 
       <div class="tab-content">
         <!-- <ul>
           <li><strong>Subscription Name:</strong> dbhome20190503015045</li>
           <li><strong>Created On:</strong> Fri, 03 May 2019 01:50:45 GMT</li>
           <li><strong>Plan Name:</strong> OLTP</li>
           <li><strong>Plan Type:</strong> AL32UTF8</li>
           <li><strong>Activated On:</strong> AL16UTF16</li>
           <li><strong>OCID:</strong> <span>...zdnwij</span> <a href="#">Show</a> <a href="#">Copy</a></li>
           <li><strong>Database Version:</strong> 18.5.0.0.190115</li>
           <li><strong>Database Unique Name:</strong> mengodb_iad1m7</li>
           <li><strong>Automatic Backup:</strong> Enabled</li>
         </ul> -->
         <div class="info-column">
            <h3 class="sub-heading">General Information</h3>
            <ul>
                <li ><strong>Subscription Name: </strong><span id="subscriptionNameinList"></span> </li>
                <li><strong >Created On: </strong><span id="createdOn"></span></li>
                <li><strong >Compartment ID: </strong> <span id="compartmentId"></span></li>
                <li><strong>Random Field 1: </strong> Lorem </li>
                <li><strong>Random Field 2: </strong> - </li>
                <li><strong>Random Field 3: </strong> - </li>
                
            </ul>
        </div>
        <div class="info-column">
            <h3 class="sub-heading">Plan Details</h3>
            <ul>
                
                <li><strong >Plan Name: </strong> <span  id="planName"></span></li>
                <li><strong >Plan Type: </strong><span id="planType"></span> - </li>
                <li><strong >Plan Description: </strong> <span id="planDescription"> - </span></li>
                <li><strong>Random Field 4:</strong> - </li>
                <li><strong>Random Field 5:</strong> - </li>
            </ul>
        </div>
       </div>
 
       <div id="tags" class="tab-content">
         <p>No tags applied.</p>
       </div>
 
       <!-- <div class="data-guard-section">
         <h3>Data Guard Associations</h3>
         <button class="btn enable">Enable Data Guard</button>
         <p>Data Guard is not enabled for this database.</p>
       </div> -->
     </div>
   </div>
 
   <script>

    const SubscriptionDataJSON = {{.SubscriptionDataJSON}};
    // const SubscriptionDataJSON = {}
    console.log("Subscription Data:", SubscriptionDataJSON);

    document.addEventListener("DOMContentLoaded", function() {
        function renderPage() {
            console.log("Inside Render Page");
            if(Object.keys(SubscriptionDataJSON).length > 0) {

                document.getElementById('subscriptionStatus').textContent = 'S';
                document.getElementById('lifecycleDetails').textContent = SubscriptionDataJSON.lifecycleDetails || 'No details available';
                document.getElementById('subscriptionName').textContent = SubscriptionDataJSON.displayName || 'No Data';
                document.getElementById('subscriptionNameinList').textContent = SubscriptionDataJSON.displayName || 'No Data';
                document.getElementById('createdOn').textContent = SubscriptionDataJSON.timeCreated || 'No Data';
                document.getElementById('planName').textContent = SubscriptionDataJSON.subscriptionDetails.pricingPlan.planName || 'No Data';
                document.getElementById('planType').textContent = SubscriptionDataJSON.subscriptionDetails.pricingPlan.planType || 'No Data';
                document.getElementById('planDescription').textContent = SubscriptionDataJSON.subscriptionDetails.pricingPlan.planDescription || 'No Data';
                document.getElementById('compartmentId').textContent = SubscriptionDataJSON.compartmentId || 'No Data';


                // Show the content
                document.getElementById('content').style.display = 'block';
            }
            else {
                console.warn('No subscription data available');
            }
        }

        console.log("Calling renderPage()");
        renderPage();
    })

    // document.getElementById('subscriptionStatus').textContent = 'MD';
    // document.getElementById('lifecycleDetails').textContent = SubscriptionDataJSON?.lifecycleDetails || 'No details available';

    // Function to get the selfTokenId from the URL

    function getSelfTokenIdFromUrl() {
        const url = window.location.href;
        const urlParts = url.split('/');
        const selfTokenId = urlParts[urlParts.length - 1];
        console.log("Extracted selfTokenId from URL:", selfTokenId); // Log the extracted selfTokenId
        return selfTokenId;
    }

    async function activateSubscription() {
        const selfTokenId = getSelfTokenIdFromUrl();

        if (!selfTokenId) {
            console.error("selfTokenId not found in URL"); // Log error if selfTokenId is missing
            alert("Invalid selfTokenId in the URL.");
            return;
        }

        console.log("Starting activation process for selfTokenId:", selfTokenId); // Log start of activation process

        try {
            // Log the request details
            const url = 'http://138.3.95.230:443/20180828/partner/subscriptions/actions/activate';
            console.log("Sending PUT request to URL:", url);
            console.log("Request payload:", JSON.stringify({ subscriptionId: selfTokenId }));

            // Send a PUT request to the activate endpoint with the selfTokenId
            const response = await fetch(url, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ subscriptionId: selfTokenId })
            });

            console.log("Response status code:", response.status); // Log the response status code

            // Check if the request was successful
            if (response.ok) {
                const result = await response.json();
                console.log("Activation successful:", result); // Log successful activation response
                const displayName = result.displayName;

                alert(`Activation Successful for ${displayName}`);

                // SubscriptionDataJSON = result;

                console.log("added data to SubscriptionDataJSON variable", result);

                // Disable the "Activate" button after successful activation
                activateButton.disabled = true;
                activateButton.textContent = "Activated";

                document.getElementById('lifecycleDetails').textContent = result.lifecycleDetails || 'No details available';
                document.getElementById('subscriptionName').textContent = result.displayName || 'No details available';
                document.getElementById('subscriptionNameinList').textContent = result.displayName || 'No details available';
                document.getElementById('createdOn').textContent = result.timeStart || 'No details available';
                



                // alert("Activation Successful for Subscription ", result.displayName); // Notify the user of successful activation
            } else {
                console.error("Failed to activate subscription. Status code:", response.status); // Log failure details
                alert("Failed to activate subscription");
            }
        } catch (error) {
            console.error("Error during activation request:", error); // Log any errors that occur
            alert("An error occurred while activating the subscription");
        }
    }











     function openTab(tabName) {
       const tabs = document.querySelectorAll('.tab-content');
       const buttons = document.querySelectorAll('.tab-btn');
 
       tabs.forEach(tab => {
         tab.classList.remove('active');
         if (tab.id === tabName) {
           tab.classList.add('active');
         }
       });
 
       buttons.forEach(button => {
         button.classList.remove('active');
         if (button.textContent.trim() === tabName.replace(/^\w/, (c) => c.toUpperCase())) {
           button.classList.add('active');
         }
       });
     }
   </script>
 </body>
 </html>
 